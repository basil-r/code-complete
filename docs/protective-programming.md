#### Захист від неправильних вхідних даних:

1. перевіряйте всі дані із зовнішніх джерел;
2. перевіряйте значення всіх вхідних параметрів методу;
3. обробляйте неправильні вхідні дані.

Конвертуйте вхідні дані в потрібний тип чим раніше, наприклад, під час введення.

Побудуйте барикади для ізоляції руйнівного ефекту помилок та зменшення обсягу коду, зайнятого в обробці помилок.

> Виділення частини коду для роботи з неперевіреними даними, а частини - з тільки коректними даними, може бути ефективним способом звільнити частину програми від відповідальності за перевірку допустимості даних.  
> Відкриті методи класу припускають, що дані небезпечні та відповідають за їх перевірку та виправлення. Якщо дані були перевірені відкритими методами, закриті методи можуть вважати, що дані є безпечними.

Встановіть налагоджувальні засоби таким чином, що їх можна активізувати та деактивувати без особливих проблем:

```javascript
const util = require("node:util");
const debuglog = util.debuglog("foo");

debuglog("hello from foo [%d]", 123);
```

```bash
NODE_DEBUG=foo node index.js
```

#### Assertion

Використовуйте твердження, щоб документувати припущення, зроблені в коді, і щоб виявити непередбачені обставини

```javascript
function foo(bar) {
  assert.ok(bar >= 0 && bar < 100, "The value is out of range");
  // ...
}
```

Зазвичай, **assertion** не призначені для промислової версії — вони переважно застосовуються при розробці та підтримці.

Використовуйте процедури обробки помилок для очікуваних подій та **assertion** для подій, які відбуватися не повинні.

Використовуйте **assertion** для документування та
перевірки передумов та постумов:

```javascript
function foo(input) {
  assert.ok(input > 100);
  // ...
  output = someAction();
  assert.ok(output > 0 && output < 1);
  return output;
}
```

Не поміщайте виконуваний код у **assertion**: `assert.ok(action())`.

Для більш надійного коду перевірте **assertion**, а потім, у будь-якому разі, обробляйте можливі помилки.

#### Способи обробки помилок:

- повернути нейтральне значення;
- замінити наступним коректним блоком даних;
- повернути той самий результат, що й у попередній раз;
- підставити найближче допустиме значення;
- залогувати попереджувальне повідомлення;
- повернути код помилки;
- показати повідомлення про помилку;
- обробити помилку у місці виникнення;
- припинити виконання.

> Вибір відповідного методу обробки помилок залежить від програми: а) краще нічого не повертати, ніж неточне значення (коректність); б) якийсь результат завжди кращий, ніж переривання (стійкість).

#### Exceptions

Використовуйте винятки для оповіщення інших частин програми про помилки, які не можна ігнорувати.

Генеруйте винятки лише для ситуацій, які не можна реалізувати іншими методами кодування.

Не генеруйте в коді виняток, що не перехоплюється, якщо помилка може бути виправлена на місці.

Уникайте генерувати винятки у конструкторах.

Переконайтеся, що рівень абстракції **exceptions** та методу збігаються:

```javascript
function deliverProduct(orderId) {
  // ...
  // bad
  throw new TypeError();
  // good
  throw new ProductOrderNotFoundError();
}
```

Включіть в опис винятку всю інформацію про його причини.

Уникайте пустих блоків **_catch_**. Краще задокументуйте обгрунтування в коментарях або запишіть повідомлення у файл журналу:

```javascript
// bad
try {
  // ...
} catch {}

// good
try {
  // ...
} catch {
  // Unexpected exception
  // or
  logger.warn("Unexpected exception");
}
```

Розгляньте можливість централізованого інформування про винятки. Тобто, подумайте про створення власного класу Exception, який може бути базовим класом для всіх винятків, що виникають у вашому проекті. Це допоможе централізувати та стандартизувати реєстрацію, обробку та інші дії з помилками.

Застосовуйте альтернативні підходи обробки помилок.

#### Інструменти захисного програмування котрі слід залишити у промисловій версії:

- залишіть код, який перевіряє суттєві помилки;
- якщо наслідки помилки справді незначні, видаліть код, який її перевіряє;
- якщо програма містить код налагодження, здатний призвести до втрати даних, приберіть його;
- залишіть код, який дозволяє акуратно завершити роботу програми;
- реєструйте помилки для технічної підтримки.

##### Питання безпеки:

- код, який перевіряє некоректні вхідні дані, повинен контролювати спроби переповнення буфера, SQL-ін'єкцій та вставки HTML-коду, переповнення цілих чисел та інших зловмисних дій;
- усі винятки повинні перехоплюватися;
- повідомлення про помилки не повинні містити інформацію, яка може допомогти зловмисникові зламати систему.
